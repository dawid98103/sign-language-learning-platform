CREATE SEQUENCE SEQ_PLATFORM_USER START 1;
CREATE TABLE PLATFORM_USER
(
    USER_ID       INTEGER      NOT NULL PRIMARY KEY DEFAULT NEXTVAL('SEQ_PLATFORM_USER'),
    USERNAME      VARCHAR(255) NOT NULL,
    PASSWORD      VARCHAR(255) NOT NULL,
    NAME          VARCHAR,
    SURNAME       VARCHAR,
    EMAIL         VARCHAR,
    ROLE_ID       INTEGER,
    POINTS        INTEGER,
    ACTIVE        BOOL,
    AVATAR_URL    VARCHAR(255),
    CREATION_DATE TIMESTAMP
);

ALTER SEQUENCE SEQ_PLATFORM_USER OWNED BY PLATFORM_USER.USER_ID;

CREATE SEQUENCE SEQ_LESSON_GROUP START 1;
CREATE TABLE LESSON_GROUP
(
    LESSON_GROUP_ID INTEGER NOT NULL PRIMARY KEY DEFAULT NEXTVAL('SEQ_LESSON_GROUP'),
    NAME            VARCHAR(255),
    ACCESS_LEVEL    INTEGER
);

ALTER SEQUENCE SEQ_LESSON_GROUP OWNED BY LESSON_GROUP.LESSON_GROUP_ID;

CREATE SEQUENCE SEQ_LESSON START 1;
CREATE TABLE LESSON
(
    LESSON_ID       INTEGER NOT NULL PRIMARY KEY DEFAULT NEXTVAL('SEQ_LESSON'),
    LESSON_GROUP_ID INTEGER,
    LESSON_NAME     VARCHAR(255),
    CONSTRAINT LESSON_GROUP_ID_FK
        FOREIGN KEY (LESSON_GROUP_ID)
            REFERENCES LESSON_GROUP (LESSON_GROUP_ID)
            ON DELETE SET NULL
);

ALTER SEQUENCE SEQ_LESSON OWNED BY LESSON.LESSON_ID;

CREATE TABLE LESSON_COMPLETED
(
    LESSON_ID       INTEGER NOT NULL,
    USER_ID         INTEGER NOT NULL,
    COMPLETION_DATE TIMESTAMP,
    PRIMARY KEY (LESSON_ID, USER_ID)
);

CREATE SEQUENCE SEQ_LESSON_STAGE START 1;
CREATE TABLE LESSON_STAGE
(
    LESSON_STAGE_ID INTEGER NOT NULL PRIMARY KEY DEFAULT NEXTVAL('SEQ_LESSON_STAGE'),
    LESSON_ID       INTEGER,
    STAGE_NAME      VARCHAR(255),
    STAGE_NUMBER    INTEGER,
    VIDEO_URL       VARCHAR(2083),
    CONSTRAINT LESSON_ID_FK
        FOREIGN KEY (LESSON_ID)
            REFERENCES LESSON (LESSON_ID)
            ON DELETE SET NULL
)

